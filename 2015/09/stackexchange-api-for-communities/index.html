<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <title>Stack Exchange API для сообществ</title>
    <meta name="author" content="Nicolas Chabanovsky"/>
    <link rel="stylesheet" href="/css/styles.css" type="text/css" media="screen, projection"/>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-50848648-1', 'auto');
  ga('send', 'pageview');

</script>
</head>
<body class="post_container">
    <div id="header">
        <a href="/">
            <div class="logo">
                Делая мир лучше
            </div>
        </a>
        <div class="meta_data">
            <div class="left">
                Николай Чабановский
            </div>
            <div class="right">
                Нью Йорк, 09/04/15
            </div>
        </div>
        <div class="title">
            <h1>
                Stack Exchange API для сообществ
            </h1>
        </div>
        <div class="big_image">
            <img src="/assets/images/stackexchange_api_big.png"/>
        </div>
        <div class="excerpt">
                Пример использования Stack Exchange API для создания страницы активности участников сообщества
        </div>
        <div class="divider">
            <img src="/assets/images/line-divider.png"/>
        </div>
    </div>
    <div id="content">
        <link rel="stylesheet" href="/assets/google-code-prettify/prettify.css" />

<link rel="stylesheet" href="/css/stackoverflow_widget.css" />

<link rel="stylesheet" href="/css/extra.css" />

<script src="/assets/google-code-prettify/prettify.js"></script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>

<script type="text/javascript" charset="utf-8" src="/js/stackoverflow_widget.js"></script>

<script type="text/javascript" charset="utf-8" src="/js/stackoverflow_widget_client.js"></script>

<h3 id="section">Свободный обмен знаниями</h3>

<blockquote>
  <p>Знание - форма существования и систематизации результатов познавательной деятельности человека. Знание помогает людям рационально организовывать свою деятельность и решать различные проблемы, возникающие в её процессе<sup><a href="https://ru.wikipedia.org/wiki/%D0%97%D0%BD%D0%B0%D0%BD%D0%B8%D0%B5">1</a></sup>.</p>
</blockquote>

<blockquote>
  <p>Знания - это сочетание оформленного опыта, ценностей, контекстной информации и взглядов эксперта, которое даёт схему для оценки и объединения нового опыта и информации<sup><a href="https://ru.wikipedia.org/wiki/%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D0%B7%D0%BD%D0%B0%D0%BD%D0%B8%D1%8F%D0%BC%D0%B8#.D0.92.D0.B8.D0.B4.D1.8B_.D0.B7.D0.BD.D0.B0.D0.BD.D0.B8.D0.B9">2</a></sup>.</p>
</blockquote>

<p>Знания накапливаются и передаются от поколения к поколению. С появлением информационных технологий процесс накопления знаний стал намного эффективней, а Интернет стал каналом доступа к ним для масс. Так, если ещё 200 лет назад книги были роскошью элиты, то сегодня все, кто имеют доступ к Сети, могут найти практически любую литературу. Масштабность этого явления сложно переоценить - раньше родившийся в семье кузнеца ребёнок в подавляющем большинстве случаев мог стать только кузнецом, теперь каждый имеет возможность самостоятельно выбирать своё будущее. В последние годы широкое распространение получила модель обмена знаниями и опытом между людьми на бескорыстной основе. Как результат, сегодня каждый может воспользоваться такими уникальными проектами, как, например, Википедия или Stack Overflow.</p>

<p>Меняется и модель обмена знаниями в реальной жизни - появляется большое количество самоорганизующихся тематических сообществ и конференций.</p>

<h3 id="section-1">Самоорганизующиеся технические сообщества</h3>

<p>Некоммерческие сообщества, посвящённые какой-либо технологии, которые обязаны благодетельности основателей и тем, кто благородно посвящает своё время тому, чтобы другие люди имели возможность получать знания.</p>

<p>Для организации встречи сообщества необходимо: подобрать удобное место проведения, найти интересных докладчиков, подготовить материалы встречи, а затем опубликовать их  в свободный доступ и, конечно же, организовать слушателей. Организация слушателей и поддержка их интереса к встречам может вызывать осложнения. В классическом понимании это ни что иное как «удержание аудитории». Коммерческие организации закладывают бюджет на ведение корпоративных блогов, учётных записей в социальных сетях и т. д., что позволяет им наращивать аудиторию, не увеличивая затрат на рекламу. С другой стороны, для некоммерческих сообществ работа с уже имеющейся аудиторией на порядок важнее, чем для коммерческих, так как денег на рекламу у них просто нет.</p>

<blockquote>
  <p><strong>В</strong>: Каким же образом организаторам некоммерческих сообществ поддерживать интерес слушателей, не неся издержек?</p>

  <p><strong>О</strong>: Предоставить возможность участникам делиться своими профессиональными достижениями!</p>
</blockquote>

<h3 id="section-2">Трансляция информации об активности участников сообщества</h3>

<p>Сообщество - группа людей, имеющих общие интересы<sup><a href="https://ru.wikipedia.org/wiki/%D0%A1%D0%BE%D0%BE%D0%B1%D1%89%D0%B5%D1%81%D1%82%D0%B2%D0%BE">3</a></sup>. Один из лучших способов поддержания интереса к сообществу - непрерывно отображать активность его участников.</p>

<p>На мой взгляд, прекрасным источником такой информации является сайт вопросов и ответов для программистов Stack Overflow. Для русскоязычных сообществ наибольший интерес может представлять его русскоязычная часть.</p>

<p><em>Что даст вашему сообществу добавление трансляции активности участников на Stack Overflow на русском?</em></p>

<ul>
  <li>Поддержать уровень вовлечения в сообщество участников без затрат на создание содержимого (а-ля «контента»).</li>
  <li>Показать, что сообщество живое.</li>
  <li>Отобразить квалификацию докладчиков и участников.</li>
  <li>Сблизить сообщество.</li>
</ul>

<p><em>Что может быть интересно участникам вашего сообщества?</em></p>

<ul>
  <li>Профессиональная активность сообщества.</li>
  <li>Квалификация докладчиков: репутация, лучшие ответы.</li>
  <li>Общий уровень знаний участников: задаваемые вопросы, публикуемые ответы.</li>
</ul>

<p><em>Что необходимо для работы со Stack Exchange API?</em></p>

<ul>
  <li>Получить ключ доступа к Stack Exchange API.</li>
  <li>Id учётных записей на Stack Overflow на русском участников, чью информацию вы бы хотели транслировать.</li>
</ul>

<h3 id="section-3">Ближе к делу! Пример реализации</h3>

<p>Давайте подробно рассмотрим, как добавить трансляцию информации об активности пользователей сообщества. В качестве примера возьмём четыре учётные записи.</p>

<ul>
  <li>VladD (<a href="http://ru.stackoverflow.com/users/10105/vladd"><code>http://ru.stackoverflow.com/users/10105/vladd</code></a>);</li>
  <li>Nick Volynkin (<a href="http://ru.stackoverflow.com/users/181472/nick-volynkin"><code>http://ru.stackoverflow.com/users/181472/nick-volynkin</code></a>);</li>
  <li>Nofate (<a href="http://ru.stackoverflow.com/users/1984/nofate"><code>http://ru.stackoverflow.com/users/1984/nofate</code></a>);</li>
  <li>Etki (<a href="http://ru.stackoverflow.com/users/16095/etki"><code>http://ru.stackoverflow.com/users/16095/etki</code></a>).</li>
</ul>

<p><sub>Это участники сообщества Stack Overflow на русском, которым я крайне симпатизирую (и не только им). День за днем удивляюсь их знаниям и эрудированности. В сложные для проекта времена именно такие ребята были и остаются для меня источником вдохновения.</sub></p>

<p><strong>Получение ключа</strong></p>

<p>Первым шагом является регистрация на <a href="http://stackapps.com/">http://stackapps.com/</a>. В боковой панели раздела «приложения» («apps») вы можете найти ссылку на <a href="https://api.stackexchange.com/docs">документацию</a>, <a href="http://stackapps.com/apps/oauth/register">регистрацию нового приложения</a> или управления существующими.</p>

<p><strong>Идентификаторы учётных записей участников</strong></p>

<p>При регистрации в вашем сообществе, попроситье участников добавить ссылку на их учётную запись на Stack Overflow на русском. Для меня идентификаторами будут <code>['10105', '181472', '1984', '16095']</code>.</p>

<p><strong>Активность участников на Stack Overflow на русском</strong></p>

<p>Вопросы и ответы - это основные типы сообщений на сайте. Для формирования активности участников необходимо <a href="http://api.stackexchange.com/docs/posts-on-users">запросить все сообщения, опубликованные ими</a>.</p>

<pre><code>http://api.stackexchange.com/2.2/users/{ids}/posts?order=desc&amp;sort=activity&amp;site=ru.stackoverflow
</code></pre>

<p><sub>Обратите внимание: <em>при запросе к серверу идентификаторы перечисляются через <strong>;</strong></em>.</sub></p>

<p>В ответ сервер отдает словарь:</p>

<pre><code>{
  "items": [
    {
      "owner": {
        "reputation": integer,
        "user_id": integer,
        "user_type": string,
        "accept_rate": integer,
        "profile_image": string,
        "display_name": string,
        "link": string
      },
      "score": integer,
      "last_activity_date": integer,
      "creation_date": integer,
      "post_type": string,
      "post_id": integer,
      "link": string
    },
    ...
  ],
  ...
}
</code></pre>

<p>В системе есть три типа сообщений:</p>

<ul>
  <li>вопросы, “post_type” - “question”;</li>
  <li>ответы, “post_type” - “answer”;</li>
  <li>комментарии, “post_type” - “comment”.</li>
</ul>

<p>Обрабатывая данные запроса, следует дополнительно запрашивать информацию о сообщении в зависимости от его типа (поле <code>post_type</code>). В случае вопроса, мы будем выводить заголовок вопроса, метки, дату публикации. Запрос к серверу на получение ответов выглядит следующим образом.</p>

<pre><code>http://api.stackexchange.com/2.2/questions/{ids}?order=desc&amp;sort=activity&amp;site=ru.stackoverflow
</code></pre>

<p>В ответ сервер вернет словарь запрошенных вопросов (в нашем случае, один вопрос с id равный 1).</p>

<pre><code>{
  "items": [
    {
      "tags": dictionary,
      "owner": {
        "reputation": integer,
        "user_id": integer,
        "user_type": string,
        "profile_image": string,
        "display_name": string,
        "link": string
      },
      "is_answered": bool,
      "view_count": integer,
      "accepted_answer_id": integer,
      "answer_count": integer,
      "community_owned_date": integer,
      "score": integer,
      "last_activity_date": integer,
      "creation_date": integer,
      "last_edit_date": integer,
      "question_id": integer,
      "link": string,
      "title": string
    },
    ...
  ],
  ...
}
</code></pre>

<p>В случае ответа, нам необходимо запросить и вопрос, и ответ, так как у ответа нет заголовка. Вопрос получаем также, как и в предыдущем случае, а ответ следующим запросом.</p>

<pre><code>http://api.stackexchange.com/2.2/answers/{ids}?order=desc&amp;sort=activity&amp;site=ru.stackoverflow
</code></pre>

<p>Ответ сервера:</p>

<pre><code>{
  "items": [
    {
      "owner": {
        "reputation": integer,
        "user_id": integer,
        "user_type": string,
        "accept_rate": integer,
        "profile_image": string,
        "display_name": string,
        "link": string
      },
      "is_accepted": bool,
      "score": integer,
      "last_activity_date": integer,
      "last_edit_date": integer,
      "creation_date": integer,
      "answer_id": integer,
      "question_id": integer
    },
    ...
  ],
  ...
}
</code></pre>

<p>С помощью этих запросов за несколько минут можно сформировать html-блок активности участников. Возможно, вы захотите подчеркнуть даты, добавить точное время или любую другую информацию.</p>

<div class="example" id="activity_root"></div>

<p><strong>Квалификация участников</strong></p>

<p>Для отображения квалификации участника, мы можем воспользоваться шаблоном страницы учётной записи на Stack Overflow на русском (например, <a href="http://ru.stackoverflow.com/users/6/nicolas-chabanovsky?tab=profile">моя страница</a>).</p>

<p>Первый шаг - запрос учетных записей.</p>

<pre><code>http://api.stackexchange.com/2.2/users/{ids}?order=desc&amp;sort=reputation&amp;site=ru.stackoverflow
</code></pre>

<p>В моем примере наибольший интерес для нас представляет имя пользователя и репутация.</p>

<pre><code>{
  "items": [
    {
      "badge_counts": {
        "bronze": integer,
        "silver": integer,
        "gold": integer
      },
      "account_id": integer,
      "is_employee": bool,
      "last_modified_date": integer,
      "last_access_date": integer,
      "age": integer,
      "reputation_change_year": integer,
      "reputation_change_quarter": integer,
      "reputation_change_month": integer,
      "reputation_change_week": integer,
      "reputation_change_day": integer,
      "reputation": integer,
      "creation_date": integer,
      "user_type": string,
      "user_id": integer,
      "accept_rate": integer,
      "location": string,
      "website_url": string,
      "link": string,
      "profile_image": string,
      "display_name": string
    },
    ...
  ],
  ...
}
</code></pre>

<p>Далее нам надо запросить вопросы и ответы участника, отсортированные по количеству голосов, а затем метки, в которых он (она) отличился наиболее значимо. Вопросы и ответы запрашиваются аналогичным образом, как и в предыдущем примере, кроме одного нюанса. Если запросить ответ через <code>http://api.stackexchange.com/2.2/answers/{ids}</code>, то почему-то сервер не добавляет ссылку на ответ. Чтобы это исправить, нам необходимо дополнительно запросить информацию о нем через <code>http://api.stackexchange.com/2.2/posts/{ids}</code>. Моя функция формирования списка ответов выглядит следующим образом.</p>

<pre><code>function createUserAnswerActivities(item) {
    var answers = document.createElement("div");
    getUsersAnswers(item.user_id, sort_score,
        function(response){
            if (response == null)
                return;

            for (var index = 0; index &lt; response.items.length; index++) {
                var item = response.items[index];

                getPosts(item.answer_id, sort_score, item, function (context, sub_response) {
                    if (sub_response == null || sub_response.items.length != 1)
                        return;

                    getQuestionItemHelper(context.question_id, sub_response.items[0], function(content){
                        $(answers).append(content);
                    },
                    function (initial_item, response_item) {
                        return createUserActivityItem(response_item.title, initial_item.link, initial_item.score);
                    });

                }, errorHandler);
            }

        }, errorHandler, best_posts_page_size);

    return answers;
}
</code></pre>

<p>Лучшие метки можно получить отправив запрос по адресу:</p>

<pre><code>http://api.stackexchange.com/2.2/users/{ids}/top-tags?site=ru.stackoverflow
</code></pre>

<p>Обратите внимание, что в запросе мы не указываем сортировку. Ответ сервера:</p>

<pre><code>{
  "items": [
    {
      "user_id": integer,
      "answer_count": integer,
      "answer_score": integer,
      "question_count": integer,
      "question_score": integer,
      "tag_name": string
    },
   ...
  ],
  ...
}
</code></pre>

<p>Результат.</p>

<div class="example" id="achievement_root"></div>

<p><strong>Общий уровень знаний участников: задаваемые вопросы, публикуемые ответы</strong></p>

<p>Одной из самых простых задач является формирование списка вопросов и ответов участников сообщества. Для простоты создадим трансляцию вопросов участников. Получить список вопросов можно отправив запрос по адресу</p>

<p>http://api.stackexchange.com/2.2/users/{ids}/questions?order=desc&amp;sort=activity&amp;site=ru.stackoverflow</p>

<p>Единственное «но», на сколько я понимаю, получить текст вопросов нельзя. Результат.</p>

<div class="example" id="questions_root"></div>

<p><strong>Вопросы и ответы по метке</strong></p>

<p>В завершении, мы можем сформировать ленту лучших вопросов и ответов участников по метке. Все тоже самое, как и раньше, только другой url.</p>

<pre><code>http://api.stackexchange.com/2.2/users/{ids}/tags/{tags}/top-questions?order=desc&amp;sort=activity&amp;site=ru.stackoverflow
</code></pre>

<p>Список вопросов по метке <span id="post-tag">python</span>.</p>

<div class="example" id="tagged_root"></div>

<h3 id="section-4">Постскриптум</h3>

<p>Все то, что делают ребята, которые организуют тематические встречи, локальные группы пользователей, конференции, не может не вдохновлять. Они тратят огромное количество времени для того, чтобы мы с вами получали знания.</p>

<p>С аналогичным оптимизмом подходят к вопросу «обучения сообществом» и свободным знаниям участники Stack Overflow на русском. Пожалуйста, обратите внимание на публикацию на Мете “<a href="http://meta.ru.stackoverflow.com/questions/883/">Поддержка «местных сообществ» знаниями</a>”, и не стесняйтесь обращаться, если вам необходимы докладчики.</p>


    </div>
    
    <div class="disqus media-padded">
        
<div class="comments">
    <div id="disqus_thread"></div>
    <script>
	    var disqus_shortname = 'chabanovsky',
	    	disqus_identifier = 'http://chabanovsky.com/2015/09/stackexchange-api-for-communities/';
	    (function() {
	        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	    })();
	</script>
    <noscript>Пожалуйста, включите JavaScript для того <a href="http://disqus.com/?ref_noscript">чтобы видеть комментарии на Disqus.</a></noscript>
</div>

    </div>
    
    <div id="footer">
    </div>
</body>
</html>